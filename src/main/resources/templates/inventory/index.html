<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Kho ƒë·ªì - EchoMMO</title>
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/inventory.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
         /* Style cho empty state */
         .empty-state { text-align: center; padding: 4rem 2rem; color: var(--text-dim); }
         .empty-state i { font-size: 4rem; margin-bottom: 1rem; }
         .empty-state p { font-size: 1.2rem; margin-bottom: 1.5rem; }

         .item-stats span { margin-right: 10px; font-size: 0.9em; color: var(--text-muted); }
         .item-price { margin-top: 5px; font-size: 0.9em; color: var(--warning); }
    </style>
</head>
<body>
<div class="home-container">
    <div th:replace="~{fragments/header :: header}"></div>

    <div class="layout">
        <div th:replace="~{fragments/sidebar :: sidebar (activePage='inventory')}"></div>

        <main class="main-content">
            <h1><i class="fas fa-box"></i> Kho ƒë·ªì c·ªßa b·∫°n</h1>

            <div class="inventory-tabs">
                <button class="tab-btn active" onclick="filterItems('all', this)">T·∫•t c·∫£</button>
                <button class="tab-btn" onclick="filterItems('weapon', this)">V≈© kh√≠</button>
                <button class="tab-btn" onclick="filterItems('armor', this)">Gi√°p</button>
                <button class="tab-btn" onclick="filterItems('potion', this)">Potion</button>
                <button class="tab-btn" onclick="filterItems('resource', this)">Nguy√™n li·ªáu</button>
                <button class="tab-btn" onclick="filterItems('other', this)">Kh√°c</button>
            </div>

            <div class="inventory-grid">
                <div th:each="item : ${items}" class="inventory-item" th:attr="data-category=${item.category ?: 'other'}">
                    <div class="item-header">
                        <span class="rarity-badge" th:classappend="${'rarity-' + (item.rarity != null ? #strings.toLowerCase(item.rarity) : 'common')}"
                              th:text="${item.rarity ?: 'Common'}">Common</span>
                        <span class="quantity-badge">x<span th:text="${item.quantity}">1</span></span>
                    </div>

                    <div class="item-image">
                        <img th:src="${item.imageUrl != null ? item.imageUrl : '/images/items/default.png'}"
                             th:alt="${item.name}">
                        <div th:if="${item.isEquipped}" class="equipped-overlay">
                            <i class="fas fa-check-circle"></i> ƒê√£ trang b·ªã
                        </div>
                    </div>

                    <div class="item-info">
                        <h3 th:text="${item.name}">Item Name</h3>
                        <p class="item-desc" th:text="${item.description}">Description</p>

                        <div class="item-stats">
                             <span th:if="${item.gameAtk != null and item.gameAtk > 0}">‚öîÔ∏è <span th:text="${item.gameAtk}">0</span></span>
                             <span th:if="${item.gameDef != null and item.gameDef > 0}">üõ°Ô∏è <span th:text="${item.gameDef}">0</span></span>
                             <span th:if="${item.gameHeal != null and item.gameHeal > 0}">‚ù§Ô∏è <span th:text="${item.gameHeal}">0</span></span>
                             <span th:if="${item.gameSlot != null and !#strings.isEmpty(item.gameSlot)}"><i class="fas fa-hand-paper"></i> <span th:text="${item.gameSlot}">Slot</span></span>
                        </div>

                        <div class="item-price">
                            <i class="fas fa-coins"></i> <span th:text="${#numbers.formatDecimal(item.basePrice, 1, 'COMMA', 2, 'POINT')}">10.00</span>
                        </div>
                    </div>

                    <div class="item-actions">
                        <th:block th:if="${item.gameSlot != null and !#strings.isEmpty(item.gameSlot)}">
                             <button th:if="${!item.isEquipped}"
                                     class="btn btn-primary btn-sm"
                                     th:onclick="'equipItem(' + ${item.userItemId} + ')'">
                                 <i class="fas fa-shield-alt"></i> Trang b·ªã
                             </button>
                             <button th:if="${item.isEquipped}"
                                     class="btn btn-secondary btn-sm"
                                     th:onclick="'unequipItem(' + ${item.userItemId} + ')'">
                                 <i class="fas fa-times"></i> G·ª° b·ªè
                             </button>
                        </th:block>

                        <button th:if="${item.category != null and #strings.equalsIgnoreCase(item.category, 'potion')}"
                                class="btn btn-success btn-sm"
                                th:onclick="'useItem(' + ${item.userItemId} + ')'">
                            <i class="fas fa-flask"></i> D√πng
                        </button>

                        <button class="btn btn-warning btn-sm"
                                th:attr="data-item-id=${item.itemId}, data-max-qty=${item.quantity}, data-item-name=${item.name}"
                                onclick="sellItemPrompt(this)">
                            <i class="fas fa-dollar-sign"></i> B√°n
                        </button>
                        </div>
                </div>
            </div>

            <div th:if="${items == null or items.isEmpty()}" class="empty-state">
                <i class="fas fa-inbox"></i>
                <p>Kho ƒë·ªì tr·ªëng</p>
                <button class="btn btn-primary" onclick="location.href='/marketplace'">
                    <i class="fas fa-store"></i> ƒêi mua s·∫Øm
                </button>
            </div>
        </main>
    </div>

    <div th:replace="~{fragments/footer :: footer}"></div>
</div>

<script th:src="@{/js/common.js}"></script>
<script th:src="@{/js/header.js}"></script>
<script th:src="@{/js/inventory.js}"></script>
</body>
</html>